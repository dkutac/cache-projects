<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="confpage.csp" application="/csp/sysmon/" default="1"><![CDATA[
<html>
<head>

<title>SYSMON Configure page</title>

<script language="cache" runat="server">
znspace "%SYS"
<<<<<<< HEAD
kill ^SYSMONClassTemp
Set Rset = ##class(%Library.ResultSet).%New("%Monitor.ItemGroup:Classes")
s Rset.RuntimeMode=1
d Rset.Execute()
=======
Set Rset = ##class(%Library.ResultSet).%New("%Monitor.ItemGroup:Classes")
s Rset.RuntimeMode=1
d Rset.Execute()
kill ^SYSMONClass
>>>>>>> 49fcae963ae9daf98d6ae0003a8f2e3383ff3077
</script>
</head>

<script language="javascript">
function classChk(checked, class_name)
{
	checked = Number(checked);
	#call(..WriteClassChanges(checked,class_name))#
}

function submitAll()
{
	#server(..SaveAll())#
}
</script>

<csp:method name = "WriteClassChanges" Arguments="a:%Integer,b:%String">
<<<<<<< HEAD
set ^SYSMONClassTemp(b) = a
</csp:method>

<csp:method name = "SaveAll">
if $data(^SYSMONClassTemp)
{
	set key = $order(^SYSMONClassTemp(""))
	while (key '= "")
	{
		set value = ^SYSMONClassTemp(key) 
		set namespace = $Namespace
=======
set ^SYSMONClass(b) = a
</csp:method>

<csp:method name = "SaveAll">
if $data(^SYSMONClass)
{
	set key = $order(^SYSMONClass(""))
	while (key '= "")
	{
		set value = ^SYSMONClass(key) 
>>>>>>> 49fcae963ae9daf98d6ae0003a8f2e3383ff3077
		zn "%SYS"
		do ##class(%Monitor.ItemGroup).MetricsClassItemGroup(key,.id)
	 	set class=##class(%Monitor.ItemGroup).%OpenId(id)
	 	set class.Activated = value
	 	do class.%Save()
<<<<<<< HEAD
	 	zn namespace
	 	set key = $order(^SYSMONClassTemp(key))
	}
	kill ^SYSMONClassTemp
=======
	 	zn "SYSMON"
	 	set key = $order(^SYSMONClass(key))
	}
	kill ^SYSMONClass
>>>>>>> 49fcae963ae9daf98d6ae0003a8f2e3383ff3077
	&js<alert("Settings changed")>
	&js<location.reload()>
	
}
</csp:method>

<body>
<form name="configform">
<csp:while condition="Rset.Next()" counter="i">
	<script language="cache" runat="server">
		if Rset.GetData(2) {set chkd = "checked"}
		else {set chkd = ""}
	</script>
	<input type="checkbox" name="#(i)#" value="#(Rset.GetData(1))#" #(chkd)# onclick="classChk(this.checked, this.value)">#(Rset.GetData(1))#</br>
</csp:while>
<input type="button" value="Apply" onclick="submitAll();"/>
</form>
</body>
</html>
]]></CSP>
</Export>
